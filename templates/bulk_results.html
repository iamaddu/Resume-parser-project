<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bulk Resume Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <div class="card shadow">
        <div class="card-body">
            <h2 class="mb-4 text-center">Bulk Resume Analysis</h2>
            {% if best_resume %}
                <div class="alert alert-success">
                    <strong>Best Match:</strong> {{ best_resume.name }} ({{ best_resume.filename }})<br>
                    <strong>Email:</strong> {{ best_resume.email }}<br>
                    <strong>Phone:</strong> {{ best_resume.phone }}<br>
                    <strong>Score:</strong> {{ best_resume.score }}%<br>
                    <small>{{ best_resume.explanation }}</small>
                </div>
            {% endif %}
            <div class="table-responsive">
            <table class="table table-bordered align-middle">
                <thead>
                    <tr>
                        <th>Filename</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Skills</th>
                        <th>Experience</th>
                        <th>Education</th>
                        <th>Score</th>
                        <th>Error</th>
                        <th>AI Generated</th>
                        <th>Why This Resume?</th>
                        <th>Selected</th>
                        <th>Selection Reason</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in results %}
                    <tr>
                        <td>{{ r.filename }}</td>
                        <td>{{ r.name }}</td>
                        <td>{{ r.email }}</td>
                        <td>{{ r.phone }}</td>
                        <td>
                            {% for skill in r.skills.split(',') if skill %}
                                <span class="badge bg-info text-dark">{{ skill.strip() }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ r.experience }}</td>
                        <td>
                            {% for edu in r.education.split(';') if edu %}
                                <span class="badge bg-secondary">{{ edu.strip() }}</span>
                            {% endfor %}
                        </td>
                        <td>{{ r.score }}</td>
                        <td>{{ r.error }}</td>
                        <td>{{ r.ai_generated }}</td>
                        <td>
                            <span title="{{ r.explanation }}">{{ r.explanation[:80] }}{% if r.explanation|length > 80 %}...{% endif %}</span>
                        </td>
                        <td>
                            {% if r.selected %}
                                <span class="badge bg-success">Selected</span>
                            {% else %}
                                <span class="badge bg-danger">Not Selected</span>
                            {% endif %}
                        </td>
                        <td>
                            <span title="{{ r.selection_reason }}">{{ r.selection_reason[:80] }}{% if r.selection_reason|length > 80 %}...{% endif %}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
            <a href="{{ url_for('index') }}" class="btn btn-outline-primary w-100">Analyze More Resumes</a>
            <form method="post" action="{{ url_for('download_results') }}">
                <input type="hidden" name="results" value='{{ results|tojson }}'>
                <button type="submit" class="btn btn-success w-100 mb-2">Download Results as CSV</button>
            </form>
        </div>
    </div>
</div>
</body>
</html>